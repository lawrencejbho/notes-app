{"ast":null,"code":"'use strict'; // hoisted due to circular dependency on command.\n\nmodule.exports = {\n  applyMiddleware,\n  commandMiddlewareFactory,\n  globalMiddlewareFactory\n};\n\nconst isPromise = require('./is-promise');\n\nconst argsert = require('./argsert');\n\nfunction globalMiddlewareFactory(globalMiddleware, context) {\n  return function (callback) {\n    let applyBeforeValidation = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    argsert('<array|function> [boolean]', [callback, applyBeforeValidation], arguments.length);\n\n    if (Array.isArray(callback)) {\n      for (let i = 0; i < callback.length; i++) {\n        if (typeof callback[i] !== 'function') {\n          throw Error('middleware must be a function');\n        }\n\n        callback[i].applyBeforeValidation = applyBeforeValidation;\n      }\n\n      Array.prototype.push.apply(globalMiddleware, callback);\n    } else if (typeof callback === 'function') {\n      callback.applyBeforeValidation = applyBeforeValidation;\n      globalMiddleware.push(callback);\n    }\n\n    return context;\n  };\n}\n\nfunction commandMiddlewareFactory(commandMiddleware) {\n  if (!commandMiddleware) return [];\n  return commandMiddleware.map(middleware => {\n    middleware.applyBeforeValidation = false;\n    return middleware;\n  });\n}\n\nfunction applyMiddleware(argv, yargs, middlewares, beforeValidation) {\n  const beforeValidationError = new Error('middleware cannot return a promise when applyBeforeValidation is true');\n  return middlewares.reduce((accumulation, middleware) => {\n    if (middleware.applyBeforeValidation !== beforeValidation) {\n      return accumulation;\n    }\n\n    if (isPromise(accumulation)) {\n      return accumulation.then(initialObj => Promise.all([initialObj, middleware(initialObj, yargs)])).then(_ref => {\n        let [initialObj, middlewareObj] = _ref;\n        return Object.assign(initialObj, middlewareObj);\n      });\n    } else {\n      const result = middleware(argv, yargs);\n      if (beforeValidation && isPromise(result)) throw beforeValidationError;\n      return isPromise(result) ? result.then(middlewareObj => Object.assign(accumulation, middlewareObj)) : Object.assign(accumulation, result);\n    }\n  }, argv);\n}","map":{"version":3,"names":["module","exports","applyMiddleware","commandMiddlewareFactory","globalMiddlewareFactory","isPromise","require","argsert","globalMiddleware","context","callback","applyBeforeValidation","arguments","length","Array","isArray","i","Error","prototype","push","apply","commandMiddleware","map","middleware","argv","yargs","middlewares","beforeValidation","beforeValidationError","reduce","accumulation","then","initialObj","Promise","all","middlewareObj","Object","assign","result"],"sources":["/home/lawrence/learn-react/react-notes-app/node_modules/yargs/lib/middleware.js"],"sourcesContent":["'use strict'\n\n// hoisted due to circular dependency on command.\nmodule.exports = {\n  applyMiddleware,\n  commandMiddlewareFactory,\n  globalMiddlewareFactory\n}\nconst isPromise = require('./is-promise')\nconst argsert = require('./argsert')\n\nfunction globalMiddlewareFactory (globalMiddleware, context) {\n  return function (callback, applyBeforeValidation = false) {\n    argsert('<array|function> [boolean]', [callback, applyBeforeValidation], arguments.length)\n    if (Array.isArray(callback)) {\n      for (let i = 0; i < callback.length; i++) {\n        if (typeof callback[i] !== 'function') {\n          throw Error('middleware must be a function')\n        }\n        callback[i].applyBeforeValidation = applyBeforeValidation\n      }\n      Array.prototype.push.apply(globalMiddleware, callback)\n    } else if (typeof callback === 'function') {\n      callback.applyBeforeValidation = applyBeforeValidation\n      globalMiddleware.push(callback)\n    }\n    return context\n  }\n}\n\nfunction commandMiddlewareFactory (commandMiddleware) {\n  if (!commandMiddleware) return []\n  return commandMiddleware.map(middleware => {\n    middleware.applyBeforeValidation = false\n    return middleware\n  })\n}\n\nfunction applyMiddleware (argv, yargs, middlewares, beforeValidation) {\n  const beforeValidationError = new Error('middleware cannot return a promise when applyBeforeValidation is true')\n  return middlewares\n    .reduce((accumulation, middleware) => {\n      if (middleware.applyBeforeValidation !== beforeValidation) {\n        return accumulation\n      }\n\n      if (isPromise(accumulation)) {\n        return accumulation\n          .then(initialObj =>\n            Promise.all([initialObj, middleware(initialObj, yargs)])\n          )\n          .then(([initialObj, middlewareObj]) =>\n            Object.assign(initialObj, middlewareObj)\n          )\n      } else {\n        const result = middleware(argv, yargs)\n        if (beforeValidation && isPromise(result)) throw beforeValidationError\n\n        return isPromise(result)\n          ? result.then(middlewareObj => Object.assign(accumulation, middlewareObj))\n          : Object.assign(accumulation, result)\n      }\n    }, argv)\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}